# Research: Docker Containerization Best Practices

**Feature**: 008-docker-containerization  
**Date**: 2026-02-09

## Research Areas

### 1. Multi-Stage Docker Builds

**Decision**: Use multi-stage builds for both frontend and backend

**Rationale**:

- Separates build dependencies from runtime dependencies
- Reduces final image size by 60-80%
- Build tools and dev dependencies not shipped to production
- Improved security (less attack surface)

**Alternatives Considered**:

- Single-stage build: Rejected due to bloated image size
- External build + copy: More complex, harder to reproduce

### 2. Base Images

**Decision**: Use slim/alpine variants

| Service  | Base Image       | Rationale                                                        |
| -------- | ---------------- | ---------------------------------------------------------------- |
| Frontend | node:20-alpine   | Small size (~50MB), sufficient for Next.js                       |
| Backend  | python:3.11-slim | Debian slim (~45MB), better compatibility than alpine for Python |

**Alternatives Considered**:

- Full Debian images: Rejected due to 200MB+ overhead
- Alpine for Python: Rejected due to musl libc compatibility issues with some packages

### 3. Non-Root User Configuration

**Decision**: Create dedicated user/group in Dockerfile

**Backend Pattern**:

```dockerfile
RUN groupadd --gid 1001 app && useradd --uid 1001 --gid app app
USER app
```

**Frontend Pattern**:

```dockerfile
RUN addgroup --system --gid 1001 nodejs
RUN adduser --system --uid 1001 nextjs
USER nextjs
```

**Rationale**:

- Security best practice (container escape mitigation)
- Required for Kubernetes Pod Security Standards
- Consistent UID/GID allows proper volume permissions

### 4. Environment Variable Injection

**Decision**: All secrets/config via runtime environment variables

**Patterns**:

- `.env` files excluded from image via `.dockerignore`
- Required vars documented in `docker run` commands
- Optional: `--env-file .env` for local development
- Build-time args only for non-sensitive config (e.g., NODE_ENV)

**Alternatives Considered**:

- Secrets in Dockerfile: Rejected (security risk, in layer history)
- External config files: More complex, harder to manage

### 5. Health Checks

**Decision**: Native `/health` endpoint for backend, no Docker HEALTHCHECK

**Rationale**:

- Backend already has `/health` endpoint returning JSON status
- Kubernetes probes are preferred over Docker HEALTHCHECK
- Simpler Dockerfile, leave orchestration to K8s

**Frontend Health**:

- No explicit health endpoint (not needed for static Next.js)
- K8s will use TCP probe on port 3000

### 6. Docker AI Agent (Gordon) Availability

**Decision**: Gordon as primary, Claude Code as fallback

**Findings**:

- Gordon is Docker Desktop's built-in AI assistant
- Enabled via Docker Desktop Settings > Features in Development > Docker AI
- Command: `docker ai` in terminal
- If unavailable, Claude Code generates Dockerfiles with documented fallback

**Fallback Documentation**:

```dockerfile
# Generated by: Claude Code (Gordon unavailable)
# Reason: Docker AI not enabled in Docker Desktop
```

### 7. .dockerignore Patterns

**Decision**: Comprehensive exclusion lists

**Backend .dockerignore**:

```
.env
.env.*
.git
.gitignore
__pycache__
*.pyc
.venv
.pytest_cache
.mypy_cache
*.md
tests/
```

**Frontend .dockerignore**:

```
.env
.env.*
.git
.gitignore
node_modules
.next
*.md
coverage/
```

### 8. Image Tagging Strategy

**Decision**: Semantic versioning + latest

**Pattern**:

- `taskflow-frontend:latest` - development/latest build
- `taskflow-frontend:1.0.0` - versioned for production
- `taskflow-backend:latest` / `taskflow-backend:1.0.0`

**Rationale**:

- Latest for local development and testing
- Versioned tags for Helm/K8s deployments
- Consistent with Kubernetes deployment patterns

## Summary

All research areas resolved. No NEEDS CLARIFICATION items remain.
